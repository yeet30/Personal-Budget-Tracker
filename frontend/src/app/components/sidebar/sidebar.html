<div class="backdrop" *ngIf="open" (click)="onClose()"></div>

<aside class="sidebar" [class.open]="open">
  <div class="sidebar-header">
    <h3>Budgets</h3>
    <button type="button" class="close-btn" (click)="onClose()">✕</button>
  </div>

  <div class="sidebar-body">
    <div *ngIf="!auth.user()" class="muted">Please log in to see your budgets.</div>

    <div *ngIf="auth.user()">
      <button class="primary-btn" type="button" (click)="openCreate()">+ New budget</button>

      <div *ngIf="loading()">Loading…</div>
      <div *ngIf="!loading() && error()" class="error">{{ error() }}</div>

      <ul class="budget-list" *ngIf="!loading() && !error()">
        <li *ngFor="let b of budgets()" class="budget-item">
          <button type="button" class="budget-link" (click)="goToBudget(b.budget_id)">
            {{ b.name }}
          </button>
        </li>

        <li *ngIf="budgets().length === 0" class="muted">No budgets yet.</li>
      </ul>

      <div *ngIf="isCreateOpen()" class="create-wrap">
        <div class="create-title">Create budget</div>

        <label>Name</label>
        <input
          [ngModel]="createForm().name"
          (ngModelChange)="patchCreateForm({ name: $event })"
          type="text"
        />
        <div class="error" *ngIf="createErrors().name">{{ createErrors().name }}</div>

        <label>Currency</label>
        <input
          [ngModel]="createForm().currency"
          (ngModelChange)="patchCreateForm({ currency: $event })"
          type="text"
        />
        <div class="error" *ngIf="createErrors().currency">{{ createErrors().currency }}</div>

        <label>Start date</label>
        <input
          [ngModel]="createForm().start_date"
          (ngModelChange)="patchCreateForm({ start_date: $event })"
          type="date"
        />
        <div class="error" *ngIf="createErrors().start_date">{{ createErrors().start_date }}</div>

        <label>End date</label>
        <input
          [ngModel]="createForm().end_date"
          (ngModelChange)="patchCreateForm({ end_date: $event })"
          type="date"
        />
        <div class="error" *ngIf="createErrors().end_date">{{ createErrors().end_date }}</div>

        <div class="error" *ngIf="createBackendError()">{{ createBackendError() }}</div>

        <div class="create-actions">
          <button type="button" class="secondary-btn" (click)="closeCreate()">Cancel</button>
          <button type="button" class="primary-btn" (click)="submitCreate()">Create</button>
        </div>
      </div>
    </div>
  </div>
</aside>
