<div class="card">
    <div><strong>Currency:</strong> {{ budget()!.currency }}</div>
    <div><strong>Period:</strong> {{ budget()!.start_date }} → {{ budget()!.end_date }}</div>
    <div><strong>Created:</strong> {{ budget()!.created_at || '—' }}</div>
    <div><strong>Your role:</strong> {{ getMyRoleLabel() }}</div>
    <div><strong>Current balance:</strong></div>
    <div><strong>Projected amount of money by the end of the period:</strong></div>
    <div id="delete-button-div"><button>Delete Budget</button></div>

    <div><strong>Total Income:</strong> {{ getTotalIncome() }} {{ budget()!.currency }}</div>
    <div><strong>Total Expenses:</strong> {{ getTotalExpense() }} {{ budget()!.currency }}</div>
    <div><strong>Net Amount:</strong> {{ getNetAmount() }} {{ budget()!.currency }}</div>

    <div *ngIf="loadingTransactions()">Loading transactions...</div>
    <div *ngIf="!loadingTransactions() && transactions().length === 0">No transactions yet.</div>
    <div *ngIf="!loadingTransactions() && transactions().length > 0">
        <h4>All Transactions</h4>
        <div class="transactions-table">
            <div class="transaction-header">
                <span>Date</span>
                <span>User</span>
                <span>Category</span>
                <span>Type</span>
                <span>Amount</span>
                <span>Description</span>
                <span *ngIf="canEditAnyTransaction()">Actions</span>
            </div>
            <div class="transaction-row" *ngFor="let t of transactions()">
                <span *ngIf="editingId() !== t.transaction_id">{{ t.date }}</span>
                <span *ngIf="editingId() === t.transaction_id">
                    <input type="date" [(ngModel)]="editForm().date" />
                </span>

                <span>{{ t.username }}</span>

                <span *ngIf="editingId() !== t.transaction_id">{{ t.category_name }}</span>
                <span *ngIf="editingId() === t.transaction_id">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <select [(ngModel)]="editForm().category_id">
                            <option *ngFor="let c of categories()" [ngValue]="c.category_id">
                                {{ c.name }}
                            </option>
                        </select>
                        <button *ngIf="isAdmin()" type="button" (click)="addNewCategory()" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">+ Add</button>
                    </div>
                </span>

                <span *ngIf="editingId() !== t.transaction_id" [class]="t.type.toLowerCase()">{{ t.type }}</span>
                <span *ngIf="editingId() === t.transaction_id">
                    <select [(ngModel)]="editForm().type">
                        <option value="INCOME">INCOME</option>
                        <option value="EXPENSE">EXPENSE</option>
                    </select>
                </span>

                <span *ngIf="editingId() !== t.transaction_id" [class]="t.type === 'INCOME' ? 'income-amount' : 'expense-amount'">
                    {{ t.type === 'INCOME' ? '+' : '-' }}{{ t.amount }} {{ t.currency }}
                </span>
                <span *ngIf="editingId() === t.transaction_id">
                    <input type="number" step="0.01" [(ngModel)]="editForm().amount" />
                </span>

                <span *ngIf="editingId() !== t.transaction_id">{{ t.description || '—' }}</span>
                <span *ngIf="editingId() === t.transaction_id">
                    <input type="text" [(ngModel)]="editForm().description" />
                </span>

                <span *ngIf="canEditAnyTransaction()" class="actions">
                    <ng-container *ngIf="editingId() !== t.transaction_id; else editActions">
                        <button *ngIf="canEditTransaction(t)" (click)="editTransaction(t)" class="edit-btn">Edit</button>
                        <button *ngIf="canEditTransaction(t)" (click)="deleteTransaction(t)" class="delete-btn">Delete</button>
                    </ng-container>
                    <ng-template #editActions>
                        <div class="edit-actions">
                            <button (click)="saveEdit()" class="save-btn">Save</button>
                            <button (click)="cancelEdit()" class="cancel-btn">Cancel</button>
                        </div>
                    </ng-template>
                </span>
            </div>
        </div>
    </div>
</div>