<section id="budget-section">
  <div class="budget-wrap">
    <div class="toolbar">
      <h1 *ngIf="budget(); else titleFallback">{{ budget()!.name }}</h1>
      <ng-template #titleFallback><h1>Budget</h1></ng-template>
    </div>

    <nav id="navigation">
      <ul>
        <li><a class="nav-button" 
          [class.active]="selectedCard() === 'overview'" 
          (click)="setCard('overview')">Overview</a>
        </li>
        <li><a class="nav-button" 
          [class.active]="selectedCard() === 'transactions'" 
          (click)="setCard('transactions')">Transactions</a>
        </li>
        <li><a class="nav-button" 
          [class.active]="selectedCard() === 'members'" 
          (click)="setCard('members')">Members</a>
        </li>
        <li><a class="nav-button" 
          [class.active]="selectedCard() === 'graphs'" 
          (click)="setCard('graphs')">Graphs</a>
        </li>
      </ul>

      <span>
        <hr>
      </span>
    </nav>

    <div *ngIf="loading()" class="info">Loading…</div>
    <div *ngIf="!loading() && error()" class="error">{{ error() }}</div>

    <div class="cards">
      @if(selectedCard() === 'overview') {<app-overview-card />}
      @if(selectedCard() === 'transactions') {<app-transactions-card />}
      @if(selectedCard() === 'members') {<app-members-card />}
      @if(selectedCard() === 'graphs') {<app-graphs-card />}
    </div>

    <div *ngIf="!loading() && budget()" class="card">
      <div class="row">
        <div><strong>Currency:</strong> {{ budget()!.currency }}</div>
        <div><strong>Period:</strong> {{ budget()!.start_date }} → {{ budget()!.end_date }}</div>
      </div>

      <div class="row">
        <div><strong>Created:</strong> {{ budget()!.created_at || '—' }}</div>
        <div><strong>Your role:</strong> {{ getMyRoleLabel() }}</div>
      </div>

      <hr />
      <hr />

      <h3>Members</h3>
      <div class="error" *ngIf="membersError()">{{ membersError() }}</div>

      <ul *ngIf="!membersError()">
        <li *ngFor="let m of members()">{{ m.username }} ({{ m.type }})</li>
      </ul>

      <div class="invite" *ngIf="budget()?.type === 'OWNER'">
        <h3>Invite user</h3>

        <input type="text" placeholder="Email or username" [(ngModel)]="inviteIdentifier" />
        <button type="button" (click)="inviteUser()">Add</button>

        <div class="error" *ngIf="inviteError">{{ inviteError }}</div>
        <div class="success" *ngIf="inviteSuccess">{{ inviteSuccess }}</div>
      </div>

      <p>This is where transactions, categories, and summary will go.</p>
      <p>
        Next steps you can add here: “Add transaction”, “Invite contributor”, “View members”, etc.
      </p>
    </div>
  </div>
</section>
