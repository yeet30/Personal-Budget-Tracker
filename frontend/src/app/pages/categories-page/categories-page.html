<section class="admin-categories">
  <h2>Manage Categories</h2>

  <div class="messages">
    <div class="error" *ngIf="error()">{{ error() }}</div>
    <div class="success" *ngIf="success()">{{ success() }}</div>
  </div>

  <div class="card">
    <h3>Create category</h3>

    <div class="grid">
      <label>
        Name
        <input type="text" [(ngModel)]="createForm().name" (input)="setCreateName($event)" />
        <div class="error" *ngIf="fieldErrors().name">
          {{ fieldErrors().name }}
        </div>
      </label>

      <label>
        Description
        <textarea [(ngModel)]="createForm().description" (input)="setCreateDescription($event)" rows="3"></textarea>
        <div class="error" *ngIf="fieldErrors().description">
          {{ fieldErrors().description }}
        </div>
      </label>
    </div>

    <button class="primary" (click)="createCategory()" [disabled]="creating()">
      {{ creating() ? 'Creating...' : 'Create' }}
    </button>
  </div>

  <div class="card">
    <h3>All categories</h3>

    <div *ngIf="loading()" class="loading">Loading categories...</div>

    <div *ngIf="!loading() && categories().length === 0" class="empty">
      No categories found.
    </div>

    <div *ngIf="!loading() && categories().length > 0" class="categories-list">
      <div
        *ngFor="let category of categories()"
        class="category-item"
        [class.editing]="editingId() === category.category_id"
      >
        <div *ngIf="editingId() !== category.category_id" class="category-display">
          <div class="category-info">
            <h4>{{ category.name }}</h4>
            <p *ngIf="category.description">{{ category.description }}</p>
            <small>Created: {{ category.created_at | date:'medium' }}</small>
          </div>
          <div class="category-actions">
            <button class="secondary" (click)="startEdit(category)">Edit</button>
            <button class="danger" (click)="deleteCategory(category)">Delete</button>
          </div>
        </div>

        <div *ngIf="editingId() === category.category_id" class="category-edit">
          <div class="grid">
            <label>
              Name
              <input type="text" [(ngModel)]="editForm().name" (input)="setEditName($event)" />
              <div class="error" *ngIf="fieldErrors().name">
                {{ fieldErrors().name }}
              </div>
            </label>

            <label>
              Description
              <textarea [(ngModel)]="editForm().description" (input)="setEditDescription($event)" rows="3"></textarea>
              <div class="error" *ngIf="fieldErrors().description">
                {{ fieldErrors().description }}
              </div>
            </label>
          </div>

          <div class="edit-actions">
            <button class="primary" (click)="saveEdit()" [disabled]="saving()">
              {{ saving() ? 'Saving...' : 'Save' }}
            </button>
            <button class="secondary" (click)="cancelEdit()">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>